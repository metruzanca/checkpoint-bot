<div align="center">
  <img src=".github/Remote_Caffeinator.png" alt="Risk of Rain 2's remote caffeinator" width="200">
  
  # â˜• Caffeinator (Checkpoint Bot)
  
  **A Discord bot for accountability and goal tracking**
  
  [![Go Version](https://img.shields.io/badge/go-1.25-blue.svg)](https://golang.org)
  [![License](https://img.shields.io/badge/license-MPL%202.0-brightgreen.svg)](LICENSE)
  
</div>

---

## ğŸ“– About

**Caffeinator** is a Discord bot for accountability groups. Create scheduled checkpoints, set goals, and track progress together.

### âœ¨ Features

- **ğŸ“… Checkpoint Management**: Create scheduled checkpoints with date/time support
- **ğŸ¯ Goal Tracking**: Set and manage goals, mark status (completed/incomplete/failed)
- **â° Timezone Support**: Automatic timezone handling per server
- **ğŸ‘¥ Multi-Server Support**: Works across multiple Discord servers
- **âš¡ Lightweight**: Built with Goâ€”idles at 10-12MB RAM usage. (Unlike similar nodejs apps)
- **ğŸ“¦ Portable Binary**: Database migrations are embeddedâ€”just build and run the binary anywhere, no external files needed.

---

## ğŸ› ï¸ Tech Stack

- **Language**: [Go](https://golang.org) 1.25+
- **Discord API**: [discordgo](https://github.com/bwmarrin/discordgo)
- **Database**: SQLite with [sqlc](https://sqlc.dev) for type-safe queries (no ORM, just SQL)
- **Migrations**: [goose](https://github.com/pressly/goose)
- **Logging**: [charmbracelet/log](https://github.com/charmbracelet/log)
- **CLI**: [Cobra](https://github.com/spf13/cobra)

---

## ğŸš€ Hosting

### Prerequisites

- Discord bot token from [Discord Developer Portal](https://discord.com/developers/applications)
- Docker (for Docker deployment) or Go 1.25+ (for building from source)

### Option 1: Docker

Deploy using Docker for easy containerized hosting:

```bash
git clone https://github.com/metruzanca/checkpoint-bot.git
cd checkpoint-bot

docker build -t caffeinator .
docker run -d \
  --name caffeinator \
  -e TOKEN="your-bot-token" \
  -v caffeinator-data:/app/db \
  caffeinator
```

### Option 2: Standalone Binary

Build and run the binary directlyâ€”perfect for VPS, dedicated servers, or any Linux/Windows/macOS system:

```bash
git clone https://github.com/metruzanca/checkpoint-bot.git
cd checkpoint-bot
go mod download
go generate ./...
go build -o checkpoint-bot .

# Run the binary
./checkpoint-bot --TOKEN="your-bot-token"
```

**Benefits of the standalone binary:**

- Completely self-containedâ€”migrations are embedded, no external files needed
- Portableâ€”move the binary anywhere and run it directly
- Lightweightâ€”single executable, no runtime dependencies
- Database auto-created at `DB_PATH` (default: `./db/checkpoint.db`)

---

## ğŸ’» For Developers

### Building from Source

```bash
git clone https://github.com/metruzanca/checkpoint-bot.git
cd checkpoint-bot
go mod download
go generate ./..
go build .
./checkpoint-bot --TOKEN="your-bot-token" # TOKEN can also be in .env file or env variable if you prefer
```

### Configuration Options

- `TOKEN` - Discord bot token (required)
- `CLIENT_ID` - Discord application client ID (for invite links)
- `DB_PATH` - Path to SQLite database file (default: `./db/checkpoint.db`)
- `CHANNEL_ID` - Optional channel ID for startup notifications
- `STARTUP_MESSAGE` - Enable/disable startup messages (default: `true`)

---

## ğŸ“š Usage

### Commands

- **`/checkpoint`** - Create a scheduled checkpoint

  - `date` (required): `YYYY-MM-DD` format
  - `time` (required): `HH:MM` or `H:MM AM/PM` format
  - Example: `/checkpoint date:2024-01-15 time:7:00 PM`

- **`/goal`** - Set or edit goals for upcoming checkpoint

  - `user` (optional): User whose goals to edit (admin only)
  - `status` (optional): `completed`, `incomplete`, or `failed`

- **`/next`** - View next upcoming checkpoint and goals

---

## ğŸ—ï¸ Project Structure

```
checkpoint-bot/
â”œâ”€â”€ cmd/                    # CLI commands
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/            # Configuration
â”‚   â”œâ”€â”€ database/          # Database layer (sqlc + goose migrations)
â”‚   â”œâ”€â”€ server/            # Bot & Discord command handlers
â”‚   â””â”€â”€ util/              # Utilities
â””â”€â”€ main.go                # Entry point
```

**Key Points**: SQL queries in `queries.sql` (generated by sqlc), commands in `internal/server/commands/`, migrations in `internal/database/migrations/`

---

## ğŸ§ª Development

### Adding a Command

1. Create file in `internal/server/commands/`
2. Define `ApplicationCommand` and `Handler`
3. Register in `init()` with `registerCommand()`
4. Use `dbContext()` for database ops (with `defer cancel()`)

### Adding a Database Query

1. Add query to `internal/database/queries/queries.sql`
2. Use `:one` for Create (returns record), `:exec` for Update/Delete
3. Run `go generate ./...` to regenerate sqlc code
4. Add method to `CheckpointDatabase` interface and implement in SQLite

### Migrations

Create `NNNNN_name.sql` in `internal/database/migrations/` with `-- +goose Up` and `-- +goose Down` sections. Migrations run automatically on startup.

---

## ğŸ“š Resources

- [DiscordGo Examples](https://github.com/bwmarrin/discordgo/tree/master/examples)
- [Awesome DiscordGo](https://github.com/bwmarrin/discordgo/wiki/Awesome-DiscordGo)

---

## ğŸ“ License

This project is licensed under the Mozilla Public License 2.0 (MPL-2.0).

---

<div align="center">
  <sub>Built with â˜• and â¤ï¸ for accountability groups everywhere</sub>
</div>
